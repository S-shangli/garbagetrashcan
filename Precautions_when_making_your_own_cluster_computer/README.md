# クラスター計算機を作るときに気をつけたいこと


この記事は下記のAdvent Calendarを協賛しております。
```
琉大 Advent Calendar 2020
https://adventar.org/calendars/5231
```


　


# 概要


この記事はクラスター計算機を作って遊ぶときに気をつけておきたいことを書き連ねていく。  
おおよそ下記のように書いてあります。


1. 概要
1. 結論
1. クラスター計算機とは
1. 同じ機材を集めろ
1. 電源はケチるな
1. 予備機も買っておけ
1. クラスター計算機の例


　


# 結論


クラスター計算機を作るときには下記に気をつけろ。


* 同じ機材を集めろ
* 電源はケチるな
* 予備機も買っておけ


　


# クラスター計算機とは


この記事でいうクラスター計算機とは下記のような物を言う。


* 個人が趣味で作成する
* 個人がお小遣いを惜しみながら投入する
* 安いSBCや中古の機材を使用しちゃう
* Linux系OSでMPI環境
* HPLが完走できる
* VMなんて信じないぞ
* Physical Computingを楽しむ


　


# 同じ機材を集めろ
手元にある様々な機材を組み合わせてヘテロジニアスな構成にすることも可能だが、それだと一体感に欠ける。
新規投資を抑えられるかもしれないが、分散並列スケジューリングに一工夫が必要になったり、機材の出入りがあるたびにお世話してあげる必要があるかもしれない。  
同じ機材を集約してホモロジニアスな構成として物理層を揃えることで、その上にのるソフトウェア的なアレコレは大分手抜きが出来る。
Linuxのシステムイメージは全ノード共通とし、必要な箇所のみMACアドレス等ユニークな部分を使って処理を分岐させることでメンテや機材の出入りが楽になった。  
ただし新たに機材を購入することになるのでコストはどうしてもかかってしまう。安いSBC(Single Board Computer)や中古品などを利用すると多少抑えられる。
* Single Board Computer
  * RaspberyPi ( $35 )
  * OrangePi PC ( $15 ) ←ちょっと安い
  * 中国から通販するときは必要数より多めに入手したほうが良い 不良品が混じる
  * 中国から通販するときは必要数を一度に購入しないほうが良い 不良品があった場合次回購入時に値引きしてもらえた
* 中古ノートパソコン
  * DELL Latitude E6230 ( 1.6諭吉 )
  * リースアップ品などを探すと、スペックの揃った機材を複数購入できる


　


# 電源はケチるな
ノートパソコンの場合は付属の電源を使えば問題ない。  
SBCを利用する際はDC5Vの電源を用意する必要があるが、個別にACアダプタを用意するより、産業用電源を買ってしまった方が後々楽ができたりする。
Amazonで探すと格安品が見つかるが、過渡特性がヨロシくなかったり、スペック通りに出力が出ないことがあったので、そこそこ名の通った製品が良い。  
* 個別のACアダプタ
  * GF06-US0512A ( 700円 )
  * 電源を個別にしておくと故障したときに全滅しない(かもしれない)が、物理的な取り回しに苦労する
  * AC100V系の口を個別に用意する必要があるし、単純に占有容積が大きい
* 産業用電源
  * RWS100B-5 ( 3800円 )
  * TDKラムダの産業用電源 これ一つでSBCを7枚分賄えるので、700円×7個より安い
  * SBCの最大負荷が同時に発生することはない、と覚悟できるなら8枚以上賄える　賄えた
  * AC100V系の配線は最小限
  * 公称スペックが信用出来る


　


# 予備機も買っておけ
安いSBCや中古機材は故障率はやはり高い(っぽい)。予め必要数よりも多めに手配しておいた方が良い。  
特にOrangePi PCは初期不良も多いので多めに買っておくのが良い。
* OrangePi PC
  * 必要数 28
  * 購入数 36
  * 故障数 6
  * SDカードインターフェースのチップが焼損する症状が複数発生した 回復不能 予備機材と交換
* Latitude E6230
  * 必要数 8
  * 購入数 9
  * 故障数 (1)
  * HDDの物理故障が発生した 予備機のHDDを移植して回復


　


# クラスター計算機の例
* opiclst-n28
    * OrangePi PC x 28個 ( + RaspberryPi2B x 1個)
    * Allwiner H3 (ARM Cortex-A7) ( + Broadcom BCM2836 ARM Cortex-A7 )
    * Total RAM 28GB ( + 1GB )
    * HPLスコア 29GFLOPS
    * 制作費 16.2諭吉
    * 安価なのでノード数を増やしやすい
    * 安価なのであんまり性能でない (SBCはEther等のIOが遅いかも)
    * https://www.youtube.com/watch?v=rtC6hwbLf9o
* latclst-n8
    * Latitude E6230 x 8個
    * Intel Core i5 3340M
    * Total RAM 32GB
    * HPLスコア 239.5GFLOPS
    * 制作費 15.8諭吉
    * SBCよりはノード数を増やしにくい
    * そこそこ性能でる(?)
    * https://www.youtube.com/watch?v=_egAjyWCxts

|opiclst-n28|latclst-n8|
|---|---|
| [![opiclst-n28](https://img.youtube.com/vi/rtC6hwbLf9o/0.jpg)](https://www.youtube.com/watch?v=rtC6hwbLf9o) | [![latclst-n8](https://img.youtube.com/vi/_egAjyWCxts/0.jpg)](https://www.youtube.com/watch?v=_egAjyWCxts) |


